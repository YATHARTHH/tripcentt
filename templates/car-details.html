<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Details - Trip-Centt</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f4f4f9; /* Light background for better readability */
        }
        .container {
            margin-top: 20px;
        }
        .card {
            margin-bottom: 20px; /* Spacing between cards */
        }
        .card-header {
            font-weight: bold;
            font-size: 1.2rem; /* Increased header font size */
        }
        .predicted-price {
            font-size: 2rem;
            font-weight: bold;
            color: #28a745; /* Green color for predicted price */
        }
        .details-table td {
            padding: 10px;
            font-size: 1.1rem; /* Slightly larger font for details */
        }
        .cta-button {
            margin-top: 20px;
            display: block;
            text-align: center;
            font-weight: bold;
            background-color: #007bff; /* Primary button color */
            color: white;
            padding: 10px;
            text-decoration: none;
            border-radius: 5px;
        }
        .cta-button:hover {
            background-color: #0056b3; /* Darker shade on hover */
        }
        .charts {
            text-align: center;
            margin-top: 20px; /* Space above charts */
        }
        .filter-label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center">Vehicle Details for {{ car_data['reg_no'] }}</h2>
        <div class="row">
            <div class="col-md-6">
                <!-- Card for showing car details fetched from API -->
                <div class="card">
                    <div class="card-header">Car Information</div>
                    <div class="card-body">
                        <table class="table details-table">
                            <tr><td>Registration Date:</td><td>{{ car_data['reg_date'] }}</td></tr>
                            <tr><td>Fuel Type:</td><td>{{ car_data['fuel_descr'] }}</td></tr>
                            <tr><td>Manufacturer:</td><td>{{ car_data['vehicle_manufacturer_name'] }}</td></tr>
                            <tr><td>Model:</td><td>{{ car_data['model'] }}</td></tr>
                            <tr><td>Engine Number:</td><td>{{ car_data['engine_no'] }}</td></tr>
                            <tr><td>Chassis Number:</td><td>{{ car_data['chassis_no'] }}</td></tr>
                            <tr><td>Ex-Showroom Price:</td><td>₹{{ car_data['sale_amount'] }}</td></tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <!-- Card for showing predicted price -->
                <div class="card">
                    <div class="card-header">Predicted Car Price</div>
                    <div class="card-body text-center">
                        <p class="predicted-price">₹{{ predicted_price }}</p>
                    </div>
                </div>
            </div>
        </div>

        <h3 class="text-center">Driving Data</h3>
        <div class="row">
            <div class="col-md-12">
                <table class="table details-table">
                    <tr><td>Average Speed:</td><td>{{ driving_data.average_speed }}</td></tr>
                    <tr><td>Hard Brakes:</td><td>{{ driving_data.hard_brakes }}</td></tr>
                    <tr><td>Rapid Accelerations:</td><td>{{ driving_data.rapid_accelerations }}</td></tr>
                    <tr><td>Trip Duration:</td><td>{{ driving_data.trip_duration }}</td></tr>
                    <tr><td>Total Distance:</td><td>{{ driving_data.total_distance }}</td></tr>
                    <tr><td>Eco Score:</td><td>{{ driving_data.eco_score }}</td></tr>
                </table>
            </div>
        </div>

        <h3 class="text-center">Driving Behavior Charts</h3>
        <div class="charts">
            <img src="data:image/png;base64,{{ chart1 }}" alt="Acceleration Over Time" class="img-fluid">
            <img src="data:image/png;base64,{{ chart2 }}" alt="Fuel Efficiency Over Time" class="img-fluid">
        </div>

        <h3 class="text-center">Recent Trips</h3>
        <div class="row">
            <div class="col-md-12">
                <!-- Dropdown for filtering trips -->
                <div class="form-group">
                    <label class="filter-label" for="tripFilter">Filter by Trip ID:</label>
                    <select id="tripFilter" class="form-control" onchange="filterTrips()">
                        <option value="">All Trips</option>
                        {% for trip in trips %}
                        <option value="{{ trip.Trip_ID }}">{{ trip.Trip_ID }}</option>
                        {% endfor %}
                    </select>
                </div>
                <table class="table table-bordered" id="tripTable">
                    <thead>
                        <tr>
                            <th>Trip ID</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Avg Acceleration</th>
                            <th>Avg Deceleration</th>
                            <th>Avg Fuel Efficiency</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for trip in trips %}
                        <tr data-trip-id="{{ trip.Trip_ID }}">
                            <td>{{ trip.Trip_ID }}</td>
                            <td>{{ trip.start_time }}</td>
                            <td>{{ trip.end_time }}</td>
                            <td>{{ trip.Avg_acceleration }}</td>
                            <td>{{ trip.Avg_deceleration }}</td>
                            <td>{{ trip.Avg_fuel_efficiency }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <a href="{{ url_for('car_login') }}" class="cta-button">Back to Login</a>
    </div>

    <!-- jQuery and Bootstrap scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        // Function to filter trips based on selected Trip ID
        function filterTrips() {
            var filterValue = $('#tripFilter').val();
            $('#tripTable tbody tr').each(function() {
                var tripId = $(this).data('trip-id');
                // Show or hide rows based on filter
                if (filterValue === "" || tripId == filterValue) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }
    </script>
</body>
</html>
